### 性能优化方案

面试的时候经常会被问到一些性能优化的方案，感觉自己没有统一总结过这个问题，每次回答这个问题，都是东一下西一下，没有一个完整的体系。所以，现在要做的事情就是使用思维导图的方式，分层次来回答这个问题，绝对的加分项。

##### 为什么要性能优化

我们进行优化的目的主要有两个，一个是让代码可复用，便于维护，另一个是提升用户体验（加载方式）。

![](https://gitee.com/beat-the-buzzer/pictures/raw/master/interview/optimize/optimize01.png)

##### 如何复用

复用代码，有前端复用，很常见的有html复用，例如404错误页面；css复用，例如修改皮肤颜色，实际上只是修改了少量的CSS；js复用，例如一些公共的方法，tool，jQuery也算是一种复用。

我们有时候也会复用一些模块，例如，使用iframe来嵌入广告。

后端也可以做一些复用，例如很早之前做JSP的时候，可以使用include来从服务端引入一些公共UI。接口的复用，举个例子，一个接口可以查询到用户信息，例如姓名性别年龄等等；另外有一个接口，是查询某个用户的其他信息，需要用户的内部ID，这个时候，我们需要先去查询用户的内部ID，然后根据ID来查询用户的其他信息，这样就多发了请求。所谓接口复用，就是我们可以在第一个接口去查询用户信息的时候，也返回ID，这样我们就可以直接使用这个ID进行下一步查询了。

后端的上传操作、数据库操作等等，也可以作为一个独立的模块进行复用。无论是上传图片还是上传视频，都需要一个服务器接受存储；数据库操作，很早之前的SSH框架，hibernate就可以看做一个对数据库操作的可复用模块。

##### 如何加载页面

一个白屏好几秒的页面值得我们等待吗？并不值得。页面的加载方式，是性能优化中一个重要的组成部分。

1. 同步加载

同步加载，举个例子，就是在一个HTML中，如果html文件加载完成了，那么这个文件里面的div,p标签等等，都加载完成了。这种加载方式的优点就是不需要建立太多的TCP连接，页面比较简单，没有复杂的交互。最常用的方法就是把图片转成了base64编码，直接写在html页面中。当然，并不是所有的图片都适用base64。base64是用6位编码来代替原来的8位二进制，所以到最后，base64编码比原图片的size大了将近1/3。（8比6大1/3）

2. 分级加载

分级加载，就是按照优先级的顺序，逐步加载页面。例如，刚进入视频网站，首先要加载出视频框，然后才是用户信息，评论等等。总之，要把最重要的东西先展示出来，不能让用户面对白屏。

3. 按需加载

按需加载，就是在加载管道有限的情况下，一些次要的，或者不在视图里的资源，可以暂缓加载。等到加载管道闲置，或者用户主动触发加载的时候，再去进行加载。

##### 优化性能指标

![](https://gitee.com/beat-the-buzzer/pictures/raw/master/interview/optimize/optimize02.png)